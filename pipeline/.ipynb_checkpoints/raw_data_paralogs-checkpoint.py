import os
import pandas as pd

if __name__ == "__main__":

    # Your gene list
    genes_of_interest = {
        'ENSG00000110092','ENSG00000112576','ENSG00000143153','ENSG00000069849','ENSG00000106976',
        'ENSG00000079805','ENSG00000197959','ENSG00000267312','ENSG00000185100','ENSG00000198380',
        'ENSG00000131459','ENSG00000135446','ENSG00000105810','ENSG00000067560','ENSG00000143878',
        'ENSG00000173614','ENSG00000163864','ENSG00000089902','ENSG00000167771','ENSG00000083067',
        'ENSG00000092439','ENSG00000135932','ENSG00000102547','ENSG00000060237','ENSG00000165238',
        'ENSG00000136997','ENSG00000134323','ENSG00000166851','ENSG00000145632','ENSG00000185359',
        'ENSG00000085449','ENSG00000185697','ENSG00000101057','ENSG00000105968','ENSG00000164032',
        'ENSG00000196230','ENSG00000188229','ENSG00000163694','ENSG00000135316','ENSG00000166167',
        'ENSG00000072803','ENSG00000137198','ENSG00000178035','ENSG00000106348','ENSG00000156508',
        'ENSG00000101210','ENSG00000115884','ENSG00000124145','ENSG00000101421','ENSG00000164695',
        'ENSG00000254505','ENSG00000111481','ENSG00000005243','ENSG00000108518','ENSG00000070087',
        'ENSG00000116039','ENSG00000147416','ENSG00000176720','ENSG00000143384','ENSG00000171552',
        'ENSG00000100417','ENSG00000140650','ENSG00000011332','ENSG00000133884','ENSG00000121892',
        'ENSG00000083642','ENSG00000133703','ENSG00000213281','ENSG00000158186','ENSG00000104833',
        'ENSG00000137285','ENSG00000258947','ENSG00000137267','ENSG00000084733','ENSG00000166128',
        'ENSG00000143545','ENSG00000018408','ENSG00000137693','ENSG00000099194','ENSG00000145284',
        'ENSG00000278540','ENSG00000076555','ENSG00000116251','ENSG00000163584','ENSG00000171791',
        'ENSG00000140379','ENSG00000129473','ENSG00000020577','ENSG00000179134','ENSG00000121879',
        'ENSG00000171608','ENSG00000105851','ENSG00000100201','ENSG00000108654','ENSG00000125618',
        'ENSG00000198807','ENSG00000073712','ENSG00000149781','ENSG00000101311','ENSG00000100030',
        'ENSG00000102882','ENSG00000221914','ENSG00000175470','ENSG00000135766','ENSG00000269858',
        'ENSG00000129521','ENSG00000147601','ENSG00000132604','ENSG00000169398','ENSG00000174292',
        'ENSG00000118971','ENSG00000180817','ENSG00000138777','ENSG00000196531','ENSG00000253506',
        'ENSG00000136238','ENSG00000128340','ENSG00000169750','ENSG00000105568','ENSG00000137713',
        'ENSG00000119787','ENSG00000184743','ENSG00000123416','ENSG00000127824','ENSG00000072401',
        'ENSG00000109332','ENSG00000131508','ENSG00000142507','ENSG00000240065','ENSG00000129351',
        'ENSG00000165209','ENSG00000204256','ENSG00000169925','ENSG00000111875','ENSG00000105011',
        'ENSG00000167553','ENSG00000183785','ENSG00000132612','ENSG00000119541','ENSG00000133026',
        'ENSG00000100345','ENSG00000050820','ENSG00000111859','ENSG00000072864','ENSG00000166579',
        'ENSG00000061676','ENSG00000123338','ENSG00000132294','ENSG00000084710','ENSG00000175582',
        'ENSG00000222014','ENSG00000154917','ENSG00000169047','ENSG00000185950','ENSG00000161405',
        'ENSG00000123411','ENSG00000017260','ENSG00000064270','ENSG00000149480','ENSG00000057935',
        'ENSG00000152601','ENSG00000139793','ENSG00000108582','ENSG00000135678','ENSG00000171940',
        'ENSG00000198597','ENSG00000101493','ENSG00000120616','ENSG00000135999','ENSG00000117394',
        'ENSG00000059804','ENSG00000173262','ENSG00000108946','ENSG00000188191','ENSG00000156515',
        'ENSG00000159399','ENSG00000111450','ENSG00000103496','ENSG00000106089','ENSG00000185591',
        'ENSG00000105866','ENSG00000217236','ENSG00000132507','ENSG00000163577','ENSG00000092531',
        'ENSG00000132639','ENSG00000067248','ENSG00000163214','ENSG00000104413','ENSG00000169045',
        'ENSG00000169813','ENSG00000103067','ENSG00000159720','ENSG00000147614','ENSG00000136448',
        'ENSG00000152465','ENSG00000161960','ENSG00000156976','ENSG00000178718','ENSG00000164967',
        'ENSG00000100749','ENSG00000105053','ENSG00000028116','ENSG00000070756','ENSG00000090621',
        'ENSG00000149925','ENSG00000109107','ENSG00000007968','ENSG00000112242','ENSG00000205250',
        'ENSG00000167522','ENSG00000160949','ENSG00000101745','ENSG00000167491','ENSG00000143614',
        'ENSG00000171262','ENSG00000130244','ENSG00000129315','ENSG00000082258','ENSG00000115419',
        'ENSG00000135423','ENSG00000139514','ENSG00000003989','ENSG00000134255','ENSG00000111666',
        'ENSG00000116954','ENSG00000025039','ENSG00000080493','ENSG00000033867','ENSG00000050438',
        'ENSG00000103257','ENSG00000092068','ENSG00000130876','ENSG00000163660','ENSG00000221978',
        'ENSG00000204390','ENSG00000109971','ENSG00000204388','ENSG00000204389','ENSG00000164548',
        'ENSG00000136527','ENSG00000029363','ENSG00000054118','ENSG00000080503','ENSG00000127616',
        'ENSG00000170558','ENSG00000062038','ENSG00000039068','ENSG00000124215','ENSG00000168710',
        'ENSG00000158467','ENSG00000165389','ENSG00000196542','ENSG00000185650','ENSG00000152518',
        'ENSG00000011304','ENSG00000117569','ENSG00000131236','ENSG00000112186','ENSG00000074800',
        'ENSG00000108515','ENSG00000111674','ENSG00000143761','ENSG00000134287','ENSG00000168374',
        'ENSG00000004059','ENSG00000172531','ENSG00000213639','ENSG00000186298','ENSG00000164087',
        'ENSG00000139323','ENSG00000177885','ENSG00000155926','ENSG00000100351','ENSG00000166347',
        'ENSG00000103018','ENSG00000099783','ENSG00000104177','ENSG00000077312','ENSG00000125870',
        'ENSG00000113575','ENSG00000104695','ENSG00000075624','ENSG00000184009','ENSG00000162385',
        'ENSG00000111196','ENSG00000103489','ENSG00000015532'
    }

    # Input folder and output file
    root_dir = "/sci/labs/orzuk/mali.tsadok/UKB/all_data/filter_data/lof"
    output_csv = "/sci/labs/orzuk/mali.tsadok/UKB/raw_data_paralogs_after_filter_and_freq.csv"

    # Collect filtered rows
    all_filtered = []

    # Walk through all subfolders
    for dirpath, dirnames, filenames in os.walk(root_dir):
        for file in filenames:
            if file.endswith(".csv"):
                print (file)
                file_path = os.path.join(dirpath, file)
                df = pd.read_csv(file_path)

                # Filter by genes of interest
                df_filtered = df[df['gene'].isin(genes_of_interest)]

                if df_filtered.empty:
                    continue

                all_filtered.append(df_filtered)

    if all_filtered:
        final_df = pd.concat(all_filtered, ignore_index=True)
        final_df.to_csv(output_csv, index=False)
        print(f"Filtered file saved to {output_csv}")
    else:
        print("No matching genes found in any CSV file.")
